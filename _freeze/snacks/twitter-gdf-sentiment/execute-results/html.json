{
  "hash": "3f8c1ce9e64ef1f884ff00465ad92408",
  "result": {
    "markdown": "---\nauthor: tam kien duong\ncode-fold: false\n---\n\n# visualiser une évolution de tweets\n\nAttention, ce snack est du fast food tendance junk food.\n\nL'ami Stéphane Wharton voulait un coup d'oeuil sur l'[analyse de sentiment qu'il a opéré sur les tweets d'un député d'extrême-droite ayant tenu des propos racistes à l'assemblée][1].\nNe faisant pas une veille sur le sujet, les questions qui semblent pertinente sont :\n\n- quel est la tonalité habituelle des propos du député sur twitter ?\n- est-ce que certaines tonalités ont un fonctionnement différent en terme d'audience ?\n\n[1]: https://social.apreslanu.it/@stefw/109286638182665737\n\n:::{.column-screen}\n:::{layout-ncol=2}\n\n![](graphics/twitter-gdf-count.png)\n\n![](graphics/twitter-gdf-retweets.png)\n\n:::\n:::\n\nComme on peut le voir, la fréquence de tweets et le nombre total de retweets ne suivent pas vraiment la même tendance.\nla distribution de retweets entre tweets positifs et négatifs n'est pas vraiment la même non plus.\n\nOn peut voir que les tweets du personnage sont perçus négativement par le modéle et que cette négativité engendre plus de réactions depuis mi 2021.\nCes réactions peuvent être positives comme négatives mais elles génèrent du bruit et amplifie ainsi la portée de son discours.\n\n## la tambouille\n\nLe détail des calculs peut être utile pour voir comment réduire les irrégularités cycliques en aggrégeant les tweets à la semaine et en opérant une moyenne glissante.\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport matplotlib.pyplot as plt\n```\n:::\n\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nsentiments = (\n    pd\n    .read_csv('https://raw.githubusercontent.com/stefw/gdf/main/gdefournasxlm-robertaok_withnature.csv')\n    .set_index('id')\n)\n\nsentiments\n```\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\ncolors = {\n    'Negative': '#FF4136',\n    'Neutral': '#DDDDDD',\n    'Positive': '#7FDBFF'\n}\n```\n:::\n\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\nsentiments_evolution = (\n    sentiments\n    .assign(\n        local_time = lambda df: pd.to_datetime(df.local_time),\n        date = lambda df: pd.to_datetime(df.local_time).dt.to_period('W')\n    )\n    .reset_index()\n    .groupby(['date', 'sentiment'])\n    .agg({\n        'id': 'count',\n        'retweet_count': ['sum', 'mean'],\n        'like_count': ['sum', 'mean']\n    })\n    .reset_index()\n    .pivot_table(\n        index='date',\n        columns='sentiment',\n        fill_value=0\n    )\n)\n\nsentiments_evolution\n```\n:::\n\n\n### graphique d'évolution des tweets\n\n::: {.cell layout-ncol='1' execution_count=5}\n``` {.python .cell-code}\n(\n    sentiments_evolution\n    [('id', 'count')]\n    .rolling(50)\n    .mean()\n    .plot\n    .area(\n        figsize=(15,10),\n        color=colors,\n        title='évolution du nombre de tweets par semaine'\n    )\n)\n\nplt.savefig('graphics/twitter-gdf-count.png')\n```\n\n::: {.cell-output .cell-output-display}\n![](twitter-gdf-sentiment_files/figure-html/cell-6-output-1.png){width=1161 height=806}\n:::\n:::\n\n\n### graphique d'évolution des retweets\n\n::: {.cell layout-ncol='1' execution_count=6}\n``` {.python .cell-code}\n(\n    sentiments_evolution\n    [('retweet_count', 'sum')]\n    .rolling(50)\n    .mean()\n    .plot\n    .area(\n        figsize=(15,10),\n        color=colors,\n        title='évolution du nombre de retweets par semaine'\n    )\n)\n\nplt.savefig('graphics/twitter-gdf-retweets.png')\n```\n\n::: {.cell-output .cell-output-display}\n![](twitter-gdf-sentiment_files/figure-html/cell-7-output-1.png){width=1170 height=806}\n:::\n:::\n\n\n### tableau de synthèse\n\n::: {.cell .column-page execution_count=7}\n``` {.python .cell-code}\nsentiments_yearly = (\n    sentiments\n    .assign(\n        local_time = lambda df: pd.to_datetime(df.local_time),\n        date = lambda df: pd.to_datetime(df.local_time).dt.to_period('Y')\n    )\n    .reset_index()\n    .groupby(['date', 'sentiment'])\n    .agg({\n        'like_count': ['mean', 'sum'],\n        'retweet_count': ['mean', 'sum'] \n    })\n    .reset_index()\n    .pivot_table(\n        index='date',\n        columns='sentiment'\n    )\n)\n\nsentiments_yearly\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n/tmp/ipykernel_102002/203913093.py:2: PerformanceWarning: dropping on a non-lexsorted multi-index without a level parameter may impact performance.\n  sentiments\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=274}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead tr th {\n        text-align: left;\n    }\n\n    .dataframe thead tr:last-of-type th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr>\n      <th></th>\n      <th colspan=\"6\" halign=\"left\">like_count</th>\n      <th colspan=\"6\" halign=\"left\">retweet_count</th>\n    </tr>\n    <tr>\n      <th></th>\n      <th colspan=\"3\" halign=\"left\">mean</th>\n      <th colspan=\"3\" halign=\"left\">sum</th>\n      <th colspan=\"3\" halign=\"left\">mean</th>\n      <th colspan=\"3\" halign=\"left\">sum</th>\n    </tr>\n    <tr>\n      <th>sentiment</th>\n      <th>Negative</th>\n      <th>Neutral</th>\n      <th>Positive</th>\n      <th>Negative</th>\n      <th>Neutral</th>\n      <th>Positive</th>\n      <th>Negative</th>\n      <th>Neutral</th>\n      <th>Positive</th>\n      <th>Negative</th>\n      <th>Neutral</th>\n      <th>Positive</th>\n    </tr>\n    <tr>\n      <th>date</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2014</th>\n      <td>0.277966</td>\n      <td>0.440860</td>\n      <td>0.474026</td>\n      <td>82.0</td>\n      <td>41.0</td>\n      <td>73.0</td>\n      <td>0.816949</td>\n      <td>1.172043</td>\n      <td>0.883117</td>\n      <td>241.0</td>\n      <td>109.0</td>\n      <td>136.0</td>\n    </tr>\n    <tr>\n      <th>2015</th>\n      <td>1.693467</td>\n      <td>1.462185</td>\n      <td>2.043860</td>\n      <td>337.0</td>\n      <td>174.0</td>\n      <td>233.0</td>\n      <td>5.065327</td>\n      <td>3.243697</td>\n      <td>4.745614</td>\n      <td>1008.0</td>\n      <td>386.0</td>\n      <td>541.0</td>\n    </tr>\n    <tr>\n      <th>2016</th>\n      <td>3.577320</td>\n      <td>3.760563</td>\n      <td>3.930481</td>\n      <td>1388.0</td>\n      <td>534.0</td>\n      <td>735.0</td>\n      <td>5.979381</td>\n      <td>8.056338</td>\n      <td>5.673797</td>\n      <td>2320.0</td>\n      <td>1144.0</td>\n      <td>1061.0</td>\n    </tr>\n    <tr>\n      <th>2017</th>\n      <td>3.893750</td>\n      <td>5.742574</td>\n      <td>7.697143</td>\n      <td>1246.0</td>\n      <td>1160.0</td>\n      <td>1347.0</td>\n      <td>5.012500</td>\n      <td>6.831683</td>\n      <td>8.622857</td>\n      <td>1604.0</td>\n      <td>1380.0</td>\n      <td>1509.0</td>\n    </tr>\n    <tr>\n      <th>2018</th>\n      <td>6.803828</td>\n      <td>4.545455</td>\n      <td>6.405405</td>\n      <td>1422.0</td>\n      <td>300.0</td>\n      <td>474.0</td>\n      <td>4.956938</td>\n      <td>2.606061</td>\n      <td>3.297297</td>\n      <td>1036.0</td>\n      <td>172.0</td>\n      <td>244.0</td>\n    </tr>\n    <tr>\n      <th>2019</th>\n      <td>6.817391</td>\n      <td>5.645570</td>\n      <td>7.728571</td>\n      <td>1568.0</td>\n      <td>446.0</td>\n      <td>541.0</td>\n      <td>5.121739</td>\n      <td>5.949367</td>\n      <td>4.300000</td>\n      <td>1178.0</td>\n      <td>470.0</td>\n      <td>301.0</td>\n    </tr>\n    <tr>\n      <th>2020</th>\n      <td>9.156627</td>\n      <td>13.728972</td>\n      <td>27.608696</td>\n      <td>2280.0</td>\n      <td>1469.0</td>\n      <td>1905.0</td>\n      <td>5.449799</td>\n      <td>7.158879</td>\n      <td>11.260870</td>\n      <td>1357.0</td>\n      <td>766.0</td>\n      <td>777.0</td>\n    </tr>\n    <tr>\n      <th>2021</th>\n      <td>38.865052</td>\n      <td>26.384000</td>\n      <td>23.614286</td>\n      <td>11232.0</td>\n      <td>3298.0</td>\n      <td>1653.0</td>\n      <td>17.231834</td>\n      <td>10.648000</td>\n      <td>7.557143</td>\n      <td>4980.0</td>\n      <td>1331.0</td>\n      <td>529.0</td>\n    </tr>\n    <tr>\n      <th>2022</th>\n      <td>140.068452</td>\n      <td>15.488889</td>\n      <td>70.910569</td>\n      <td>47063.0</td>\n      <td>2091.0</td>\n      <td>8722.0</td>\n      <td>45.199405</td>\n      <td>4.622222</td>\n      <td>18.910569</td>\n      <td>15187.0</td>\n      <td>624.0</td>\n      <td>2326.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "twitter-gdf-sentiment_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}
{
  "hash": "ff9f08b8f79d13a160ade4e5fcc00218",
  "result": {
    "markdown": "# visualiser la divergence entre l'ipc et la consommation en biens\n\nDans ce court article, nous allons regarder comment produire un graphique permettant de comparer l'évolution des prix de la consommation alimentaire et l'évolution des quantités de biens consommés.\nPour cela, nous allons utilisé les données de l'INSEE ainsi que `pandas` et `matplotlib`.\n\n![](./graphics/divergence_ipc_consobiens.png)\n\n## les données\n\n:::{.callout-warning}\n\nLe contenu en dessous est encore à l'état de brouillon. Il s'agit avant tout de notes de travail qui ne font pas encore complètement sens et à ne pas prendre trop au sérieux.\n\n:::\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport matplotlib.pyplot as plt\n```\n:::\n\n\n### la consommation des ménages en biens\n\nLes données proviennent de l'INSEE.\nLe fichier mis à disposition est un fichier Excel assez sale mais facile à remettre en forme en quelques lignes de pandas.\nLa principale fonction est `pd.read_excel()` avec quelques paramètres pour notamment sauter des lignes de présentation ainsi que sélectionner directement quelques colonnes.\n\nLe fichier est disponible tel quel en ligne et il suffit donc de fournir l'URL.\n\n::: {.cell execution_count=2}\n``` {.python .cell-code code-fold=\"false\"}\nbiens = (\n    pd\n    .read_excel(\n        'https://www.insee.fr/fr/statistiques/fichier/7614669/111_IR_Biens.xlsx',\n        sheet_name = \"Niveaux - Levels\",\n        skiprows = 10,\n        usecols = \"A,C:D\",\n        names = ['date', 'alimentaire', 'alimentaire hors tabac']\n    )\n    .set_index('date')\n)\n\n(\n    biens\n    .plot\n    .line()\n);\n```\n\n::: {.cell-output .cell-output-display}\n![](divergence-consobiens-hicp_files/figure-html/cell-3-output-1.png){width=592 height=429}\n:::\n:::\n\n\n### l'indice des prix à la consommation\n\nPour l'indice des prix à la consommation c'est la même manipulation mais cette fois-ci, il faut dézipper le fichier et sélectionner le fichier `excel`.\nC'est très certainement automatisable mais pour cet exemple, j'ai fait cela à la main.\n\nÀ noter aussi l'usage de `pd.to_datetime()` pour convertir la colonne `date` en objet `datetime` de pandas.\n\n> Définition : l’indice des prix à la consommation harmonisé (IPCH) est utilisé pour les comparaisons entre membres de l’Union européenne. Il est calculé pour tous les ménages, en France. La principale différence entre l’IPCH et l’IPC porte sur les dépenses de santé : l’IPCH suit des prix nets des remboursements de la sécurité sociale tandis que l’IPC suit des prix bruts.\n>\n> https://www.insee.fr/fr/statistiques/7233968#tableau-ipc-flash-g1-fr\n\n::: {.cell execution_count=3}\n``` {.python .cell-code code-fold=\"false\"}\n# HICP - Reference year 2015=100 - All households - France - COICOP\n# classification: 01 - Food and non-alcoholic beverages Identifier 001762445\n\nipc = (\n    pd.\n    read_excel(\n        'data/serie_001762445_05072023.xlsx',\n        skiprows = 3,\n        names = ['date', 'ipc']\n    )\n    .assign(date = lambda df: pd.to_datetime(df.date))\n    .set_index('date')\n    .sort_index()\n)\n\n(\n    ipc\n    .plot\n    .line()\n);\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n/home/tk/.virtualenvs/kitchen/lib/python3.10/site-packages/openpyxl/styles/stylesheet.py:226: UserWarning: Workbook contains no default style, apply openpyxl's default\n  warn(\"Workbook contains no default style, apply openpyxl's default\")\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](divergence-consobiens-hicp_files/figure-html/cell-4-output-2.png){width=575 height=429}\n:::\n:::\n\n\n## les deux courbes affichées sans aucun pré-réglage\n\n::: {.cell layout-ncol='1' execution_count=4}\n``` {.python .cell-code}\nfig, ax = plt.subplots(figsize=(12,8))\n\n(\n    biens\n    .plot\n    .line(\n        ax= ax,\n        y = 'alimentaire hors tabac'\n    )\n)\n\n(\n    ipc\n    .plot\n    .line(\n        ax = ax,\n        secondary_y = True,\n    )\n)\n\nplt.tight_layout()\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](divergence-consobiens-hicp_files/figure-html/cell-5-output-1.png){width=1142 height=758}\n:::\n:::\n\n\n## consommation en biens indexée sur 2015\n\n::: {.cell execution_count=5}\n``` {.python .cell-code code-fold=\"false\"}\nbiens_2015 = (\n    biens\n    .div(\n        biens\n        .loc['2015']\n        .mean()\n    )\n    .mul(100)\n)\n```\n:::\n\n\n::: {.cell layout-ncol='1' execution_count=6}\n``` {.python .cell-code}\nfig, ax = plt.subplots(figsize=(12,8))\n\n(\n    biens_2015\n    .plot\n    .line(\n        ax= ax,\n        y = 'alimentaire hors tabac'\n    )\n)\n\n(\n    ipc\n    .plot\n    .line(ax = ax)\n)\n\nplt.tight_layout()\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](divergence-consobiens-hicp_files/figure-html/cell-7-output-1.png){width=1142 height=758}\n:::\n:::\n\n\n### une abscisse qui commence à 0\n\n::: {.cell layout-ncol='1' execution_count=7}\n``` {.python .cell-code}\nfig, ax = plt.subplots(figsize=(12,8))\n\n(\n    biens_2015\n    .plot\n    .line(\n        ax= ax,\n        y = 'alimentaire hors tabac'\n    )\n)\n\n(\n    ipc\n    .plot\n    .line(ax = ax)\n)\n\nax.set_ylim([0, ipc.ipc.max() * 1.1 ])\n\nplt.tight_layout()\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](divergence-consobiens-hicp_files/figure-html/cell-8-output-1.png){width=1142 height=758}\n:::\n:::\n\n\n### avec un peu de travail cosmétique\n\n- enlever le cadre du graphique ;\n- utiliser une grille verticale ;\n- remplacer la légende par une annotation de chacun des séries.\n\n::: {.cell layout-ncol='1' execution_count=8}\n``` {.python .cell-code code-fold=\"false\"}\nfig, ax = plt.subplots(figsize=(12,8))\n\n(\n    biens_2015\n    .loc['1996':]\n    .plot\n    .line(\n        ax= ax,\n        y = 'alimentaire hors tabac',\n        color = '#555'\n    )\n)\n\nax.annotate(\n    text = 'consommation des ménages en biens\\nalimentation\\nannée de référence 2015',\n    xy = (biens_2015.index[-1], biens_2015['alimentaire'].iloc[-1]),\n    xytext = (3, 6),\n    textcoords = 'offset points',\n    color = '#555'\n)\n\n(\n    ipc\n    .plot\n    .line(\n        ax = ax,\n        color= '#800020'\n    )\n)\n\nax.annotate(\n    text = 'indice des prix à la consommation (ipc)\\nalimentation hors alcool\\nannée de référence 2015',\n    xy = (ipc.index[-1], ipc.ipc.iloc[-1]),\n    xytext = (3, -10),\n    textcoords = 'offset points',\n    color= '#800020'\n)\n\nax.get_legend().remove()\n\nax.spines['top'].set_visible(False)\nax.spines['bottom'].set_visible(False)\nax.spines['right'].set_visible(False)\nax.spines['left'].set_visible(False)\n\n\nax.set_xlabel(None)\n\nax.grid(axis='y')\n\nax.set_title(\"\"\"\nL'indice des prix à la consommation et la consommation des ménages en biens divergent de façon spectaculaire à partir de 2022 et un dérèglement systémique en 2020 suite au covid.\n\"\"\",\n    loc = 'left',\n    fontdict = {\n        'fontsize': 14,\n        'fontweight': 'bold'\n    },\n    wrap = True\n)\n\nplt.tight_layout()\n\nplt.savefig('graphics/divergence_ipc_consobiens.png')\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](divergence-consobiens-hicp_files/figure-html/cell-9-output-1.png){width=2000 height=753}\n:::\n:::\n\n\n## compilation des données\n\nExporter les données pour les utiliser dans un autre logiciel de visualisation.\n\n::: {.cell execution_count=9}\n``` {.python .cell-code code-fold=\"false\"}\n(\n    biens_2015\n    .loc['1996':]\n    .join(ipc)\n    .to_csv('datasets/divergence_ipc_consobiens.csv')\n)\n```\n:::\n\n\n",
    "supporting": [
      "divergence-consobiens-hicp_files"
    ],
    "filters": [],
    "includes": {}
  }
}
{
  "hash": "9ea3097095a06ef3bc9fcee3915b26bc",
  "result": {
    "markdown": "::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport geopandas as gpd\nimport matplotlib.pyplot as plt\n```\n:::\n\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nzones_exclude = [\n    '971',\n    '972',\n    '973',\n    '974',\n    '976',\n    '97500',\n    '98'\n]\n\nniveaux = {\n    'Crise': '#FF4136',\n    'Alerte renforcée': '#FF851B',\n    'Alerte': '#FFDC00',\n    'Vigilance': '#AAAAAA'\n}\n```\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\npropluvia = (\n\tpd\n\t.read_csv('https://raw.githubusercontent.com/taniki/propluvia/main/propluvia.csv')\n\t.assign(\n\t\tDate_debut = lambda d: pd.to_datetime(d.Date_debut, errors='coerce'),\n\t\tDate_fin = lambda d: pd.to_datetime(d.Date_fin, errors='coerce'),\n\t\tNIVEAU= lambda d: d.NIVEAU.astype('category'),\n\t\tRegion= lambda d: d.Region.astype('category'),\n\t\tDepartement= lambda d: d.Departement.astype('category'),\n\t)\n\t.drop_duplicates()\n)\n\npropluvia\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Code_ZA</th>\n      <th>Libelle_ZA</th>\n      <th>NIVEAU</th>\n      <th>Date_debut</th>\n      <th>Date_fin</th>\n      <th>Duree</th>\n      <th>Surface</th>\n      <th>AC_Concerne</th>\n      <th>Numero_AR</th>\n      <th>Region</th>\n      <th>Bassin</th>\n      <th>Departement</th>\n      <th>Type_de_zone</th>\n      <th>Durée</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>11_77_02</td>\n      <td>Nappe Champigny Est</td>\n      <td>Crise renforcée</td>\n      <td>2010-05-01</td>\n      <td>2011-02-28</td>\n      <td>303.0</td>\n      <td>550.51</td>\n      <td>NaN</td>\n      <td>2010/DDEA/SEPR/195</td>\n      <td>Île-de-France</td>\n      <td>SEINE-NORMANDIE</td>\n      <td>Seine-et-Marne</td>\n      <td>Souterraine</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>11_77_03</td>\n      <td>Nappe Champigny Ouest</td>\n      <td>Crise renforcée</td>\n      <td>2010-05-01</td>\n      <td>2011-02-28</td>\n      <td>303.0</td>\n      <td>1718.08</td>\n      <td>NaN</td>\n      <td>2010/DDEA/SEPR/195</td>\n      <td>Île-de-France</td>\n      <td>SEINE-NORMANDIE</td>\n      <td>Seine-et-Marne</td>\n      <td>Souterraine</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>11_91_01</td>\n      <td>Bassin de l'Yerres</td>\n      <td>Absence de restriction</td>\n      <td>2010-05-05</td>\n      <td>2011-03-01</td>\n      <td>300.0</td>\n      <td>47.49</td>\n      <td>NaN</td>\n      <td>2010-DDEA?SE?132</td>\n      <td>Île-de-France</td>\n      <td>SEINE-NORMANDIE</td>\n      <td>Essonne</td>\n      <td>Superficielle</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>11_91_01</td>\n      <td>Nappe Champigny Ouest</td>\n      <td>Crise renforcée</td>\n      <td>2010-05-05</td>\n      <td>2011-03-01</td>\n      <td>300.0</td>\n      <td>76.94</td>\n      <td>NaN</td>\n      <td>2010-DDEA?SE?132</td>\n      <td>Île-de-France</td>\n      <td>SEINE-NORMANDIE</td>\n      <td>Essonne</td>\n      <td>Souterraine</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>11_91_02</td>\n      <td>Bassin de l'Ecole</td>\n      <td>Absence de restriction</td>\n      <td>2010-05-05</td>\n      <td>2011-03-01</td>\n      <td>300.0</td>\n      <td>117.62</td>\n      <td>NaN</td>\n      <td>2010-DDEA?SE?132</td>\n      <td>Île-de-France</td>\n      <td>SEINE-NORMANDIE</td>\n      <td>Essonne</td>\n      <td>Superficielle</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>42964</th>\n      <td>MP 14</td>\n      <td>Nappe des Autises</td>\n      <td>Alerte</td>\n      <td>2022-05-09</td>\n      <td>2022-05-15</td>\n      <td>6.0</td>\n      <td>260.97</td>\n      <td>NaN</td>\n      <td>AP-22-DDTM85-303</td>\n      <td>Pays de la Loire</td>\n      <td>LOIRE-BRETAGNE</td>\n      <td>Vendée</td>\n      <td>Souterraine</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>42965</th>\n      <td>MP 14</td>\n      <td>Nappe des Autises</td>\n      <td>Alerte</td>\n      <td>2022-06-17</td>\n      <td>2022-07-01</td>\n      <td>14.0</td>\n      <td>260.97</td>\n      <td>NaN</td>\n      <td>22-DDTM85-409</td>\n      <td>Pays de la Loire</td>\n      <td>LOIRE-BRETAGNE</td>\n      <td>Vendée</td>\n      <td>Souterraine</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>42966</th>\n      <td>MP 14</td>\n      <td>Nappe des Autises</td>\n      <td>Alerte</td>\n      <td>2022-05-20</td>\n      <td>2022-06-07</td>\n      <td>18.0</td>\n      <td>260.97</td>\n      <td>NaN</td>\n      <td>AP-22-DDTM85-336</td>\n      <td>Pays de la Loire</td>\n      <td>LOIRE-BRETAGNE</td>\n      <td>Vendée</td>\n      <td>Souterraine</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>42967</th>\n      <td>MP 14</td>\n      <td>Nappe des Autises</td>\n      <td>Vigilance</td>\n      <td>2022-07-08</td>\n      <td>2022-07-22</td>\n      <td>14.0</td>\n      <td>260.97</td>\n      <td>NaN</td>\n      <td>22-DDTM85-452</td>\n      <td>Pays de la Loire</td>\n      <td>LOIRE-BRETAGNE</td>\n      <td>Vendée</td>\n      <td>Souterraine</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>42968</th>\n      <td>MP 14</td>\n      <td>Nappe des Autises</td>\n      <td>Vigilance</td>\n      <td>2022-07-22</td>\n      <td>2022-10-31</td>\n      <td>101.0</td>\n      <td>260.97</td>\n      <td>NaN</td>\n      <td>22-DDTM85-504</td>\n      <td>Pays de la Loire</td>\n      <td>LOIRE-BRETAGNE</td>\n      <td>Vendée</td>\n      <td>Souterraine</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n<p>42857 rows × 14 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\nzones = (\n    gpd\n    .read_file('../../datasets/propluvia/SHP_20220806.geojson')\n    .assign(\n        type= lambda d: d.type.astype('category')\n    )\n    .set_index('codeZA')\n    .query('not codeDep.isin(@zones_exclude)')    \n)\n\nzones\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>idZone</th>\n      <th>idBassin</th>\n      <th>idDep</th>\n      <th>codeDep</th>\n      <th>type</th>\n      <th>version</th>\n      <th>geometry</th>\n    </tr>\n    <tr>\n      <th>codeZA</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>52_49_14</th>\n      <td>3235</td>\n      <td>5</td>\n      <td>112</td>\n      <td>49</td>\n      <td>Polygon</td>\n      <td>1.0</td>\n      <td>POLYGON ((-0.09315 47.48083, -0.09325 47.46446...</td>\n    </tr>\n    <tr>\n      <th>54_79_6</th>\n      <td>3236</td>\n      <td>6</td>\n      <td>143</td>\n      <td>79</td>\n      <td>Polygon</td>\n      <td>1.0</td>\n      <td>POLYGON ((0.01832 46.15463, 0.02665 46.15214, ...</td>\n    </tr>\n    <tr>\n      <th>94_2A_1</th>\n      <td>3237</td>\n      <td>7</td>\n      <td>149</td>\n      <td>2A</td>\n      <td>MultiPolygon</td>\n      <td>1.0</td>\n      <td>MULTIPOLYGON (((9.37283 41.55851, 9.37050 41.5...</td>\n    </tr>\n    <tr>\n      <th>94_2A_2</th>\n      <td>3238</td>\n      <td>7</td>\n      <td>149</td>\n      <td>2A</td>\n      <td>MultiPolygon</td>\n      <td>1.0</td>\n      <td>MULTIPOLYGON (((8.76369 41.92079, 8.76323 41.9...</td>\n    </tr>\n    <tr>\n      <th>94_2B_1</th>\n      <td>3239</td>\n      <td>7</td>\n      <td>150</td>\n      <td>2B</td>\n      <td>Polygon</td>\n      <td>1.0</td>\n      <td>POLYGON ((9.55624 42.14266, 9.54929 42.10387, ...</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>10334</td>\n      <td>5</td>\n      <td>152</td>\n      <td>22</td>\n      <td>MultiPolygon</td>\n      <td>3.0</td>\n      <td>MULTIPOLYGON (((-3.56092 48.82717, -3.56080 48...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>10335</td>\n      <td>5</td>\n      <td>152</td>\n      <td>22</td>\n      <td>MultiPolygon</td>\n      <td>3.0</td>\n      <td>MULTIPOLYGON (((-2.82471 48.65351, -2.82468 48...</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>10336</td>\n      <td>5</td>\n      <td>152</td>\n      <td>22</td>\n      <td>Polygon</td>\n      <td>3.0</td>\n      <td>POLYGON ((-3.56642 48.19008, -3.56601 48.19015...</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>10337</td>\n      <td>5</td>\n      <td>152</td>\n      <td>22</td>\n      <td>Polygon</td>\n      <td>3.0</td>\n      <td>POLYGON ((-2.54141 48.30555, -2.54125 48.30555...</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>10338</td>\n      <td>5</td>\n      <td>152</td>\n      <td>22</td>\n      <td>MultiPolygon</td>\n      <td>3.0</td>\n      <td>MULTIPOLYGON (((-2.50502 48.25194, -2.51164 48...</td>\n    </tr>\n  </tbody>\n</table>\n<p>6356 rows × 7 columns</p>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nyears = propluvia.Date_debut.dt.year.dropna().unique().tolist()\n\nyears\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\n[2010.0,\n 2011.0,\n 2012.0,\n 2013.0,\n 2014.0,\n 2015.0,\n 2016.0,\n 2017.0,\n 2018.0,\n 2019.0,\n 2020.0,\n 2021.0,\n 2022.0]\n```\n:::\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\ndef year_levels(y):\n    return (\n        propluvia\n        .query('NIVEAU.isin(list(@niveaux.keys()))')\n        .query('Date_debut.dt.year == @y or Date_fin.dt.year == @y')\n        .dropna(subset=['Date_debut', 'Date_fin'])\n        .assign(\n            debut_borne = pd.to_datetime(f'{y}-01-01'),\n            fin_borne = pd.to_datetime(f'{y}-12-31'),\n        )\n        .assign(\n            debut = lambda d: d[['debut_borne', 'Date_debut']].max(axis=1),\n            fin = lambda d: d[['fin_borne', 'Date_fin']].min(axis=1)\n        )\n        .assign(\n            jours = lambda d: (d.fin - d.debut).dt.days\n        )\n        .groupby(['Code_ZA', 'NIVEAU'])\n        [['jours']]\n        .sum()\n        .reset_index()\n        .pivot_table(\n            index='Code_ZA',\n            columns='NIVEAU',\n            values='jours'\n        )\n        #.reset_index()\n        [list(niveaux.keys())]\n    )\n    \nyear_levels(2022).describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>NIVEAU</th>\n      <th>Crise</th>\n      <th>Alerte renforcée</th>\n      <th>Alerte</th>\n      <th>Vigilance</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>1293.000000</td>\n      <td>1293.000000</td>\n      <td>1293.000000</td>\n      <td>1293.000000</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>38.460170</td>\n      <td>38.104408</td>\n      <td>36.086620</td>\n      <td>35.984532</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>64.519618</td>\n      <td>62.218959</td>\n      <td>50.952235</td>\n      <td>52.026530</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>-1.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>12.000000</td>\n      <td>15.000000</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>92.000000</td>\n      <td>68.000000</td>\n      <td>61.000000</td>\n      <td>49.000000</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>348.000000</td>\n      <td>431.000000</td>\n      <td>390.000000</td>\n      <td>433.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\n(\n    year_levels(2022)\n    .join(zones)\n    .pipe(lambda df: gpd.GeoDataFrame(df))\n    #[['Alerte', 'geometry']]\n    .plot(\n        column='Alerte',\n        cmap='Reds',\n        legend=True\n    )\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```\n<AxesSubplot:>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](propluvia-cartes-jours_files/figure-html/cell-8-output-2.png){width=502 height=404}\n:::\n:::\n\n\n",
    "supporting": [
      "propluvia-cartes-jours_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}
{
  "hash": "e783b2e715c393ca4d9cd2d2dbc9dafe",
  "result": {
    "markdown": "---\ntitle: spatialisation des députés avec une analyse en composantes principales\nauthor: duong tam kien\n---\n\nDans le cadre d'un [article] sur l'anniversaire de la 16e législature et au détour d'analyses sur les votes et les interventions des députés, j'ai pu produire une modeste spatialisation des députés en fonction de leur vote.\nCet article est une recette assez simple pour reproduire cette visualisation en expliquant les différentes étapes ainsi que les principes rationnels en arrière-fond.\nCe n'est pas vraiment de la cuisine de haute volée, mais de la transparence sur les méthodes ne fait jamais de mal.\n\n[article]: https://www.mediapart.fr/journal/politique/220623/un-de-votes-attrape-tout-pour-le-rn\n\n## la visualisation\n\n![](graphics/acteurs_pca_scrutins.png)\n\nC'est une visualisation surtout illustrative et exploratoire au contraire d'avoir une valeur explicative.\nAinsi, le vide autour des députés RN ne permet pas d’inférer grand-chose sur le cordon sanitaire, mais par contre on peut se poser des questions sur l'absence d'une droite d'opposition.\n\n## la recette\n\n### les ustensiles\n\nPour cette petite recette, nous aurons besoin de trois ustensiles de cuisine assez classiques :\n\n- [pandas] pour la manipulation des données\n- [matplotlib] pour la visualisation\n- et enfin [scikit-learn] pour l'analyse en composantes principales\n\n[pandas]: https://pandas.pydata.org/\n[matplotlib]: https://matplotlib.org/\n[scikit-learn]: https://scikit-learn.org/\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom sklearn.decomposition import PCA\n```\n:::\n\n\n### les ingrédients\n\nLes données dont on a besoin sont essentiellement les votes des députés.\nElles proviennent du site [open data de l'Assemblée Nationale](https://data.assemblee-nationale.fr/).\nInitialement au format XML, et un export au format JSON assez dégueux, ici, nous utiliserons une version légèrement retraitée dont le processus est consultable [ici](https://github.com/taniki/assemblee-nationale/blob/main/an-l16/1_prep_scrutins_votes.ipynb).\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nbase = \"https://raw.githubusercontent.com/taniki/assemblee-nationale/main/an-l16/\"\n\norganes = pd.read_csv(f'{base}out/organes.csv')\nacteurs = pd.read_csv(f'{base}out/acteurs.csv')\nvotes = pd.read_csv(f'{base}out/votes.csv')\n```\n:::\n\n\n### vectoriser les députés\n\nChaque député vote \"pour\", \"contre\" ou \"s'abstient\", c'est sa position, a un nombre fini de scrutins.\nNous allons nous servir de cette information pour construire un vecteur pour chaque député.\nChaque colonne correspond donc à un scrutin dont la valeur est encodée numériquement de la façon suivante :\n\n- `1` pour un vote \"pour\"\n- `-1` pour un vote \"contre\"\n- `0` pour un vote \"abstention\"\n\nÀ noter que cela pourrait être n'importe quelle autre séquence de chiffre, mais ainsi on peut faire quelques calculs.\n\nPar souci de cohérence, nous allons stocker ces vecteurs dans une variable $X$ comme l'idée est d'avoir une fonction de la forme $y = f(X)$ permettant de situer les députées en fonction de leur vote.\nLe machine learning permet de trouver les paramètres de cette fonction $f$.\n\nPour passer d'un *dataframe* au format `long` à une matrice, nous allons utiliser la bonne vieille fonction [`pivot_table`] de pandas.\n\n[`pivot_table`]: https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html\n\n::: {.cell execution_count=3}\n``` {.python .cell-code code-fold=\"false\"}\nX = (\n    votes\n    .assign(\n        position = lambda df: df.position.replace({'contre': -1, 'pour': 1, 'abstention': 0 })\n    )\n    .pivot_table(\n        index='acteurRef',\n        columns='scrutin',\n        values='position'\n    )\n    .fillna(0)\n)\n\nX\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>scrutin</th>\n      <th>VTANR5L16V1</th>\n      <th>VTANR5L16V10</th>\n      <th>VTANR5L16V100</th>\n      <th>VTANR5L16V1000</th>\n      <th>VTANR5L16V1001</th>\n      <th>VTANR5L16V1002</th>\n      <th>VTANR5L16V1003</th>\n      <th>VTANR5L16V1004</th>\n      <th>VTANR5L16V1005</th>\n      <th>VTANR5L16V1006</th>\n      <th>...</th>\n      <th>VTANR5L16V990</th>\n      <th>VTANR5L16V991</th>\n      <th>VTANR5L16V992</th>\n      <th>VTANR5L16V993</th>\n      <th>VTANR5L16V994</th>\n      <th>VTANR5L16V995</th>\n      <th>VTANR5L16V996</th>\n      <th>VTANR5L16V997</th>\n      <th>VTANR5L16V998</th>\n      <th>VTANR5L16V999</th>\n    </tr>\n    <tr>\n      <th>acteurRef</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>PA1008</th>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>PA1206</th>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>PA1327</th>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>PA1567</th>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>PA1592</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>PA805166</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>...</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n    </tr>\n    <tr>\n      <th>PA817203</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>...</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n    </tr>\n    <tr>\n      <th>PA817211</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>...</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>PA822617</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>PA942</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n<p>581 rows × 1858 columns</p>\n</div>\n```\n:::\n:::\n\n\nOn se retrouve bien avec une matrice dont les dimensions correspondent au nombre de députés ayant votés en lignes et au nombre de scrutins en colonnes.  \nUne somme sur les lignes (`X.sum(axis=1)`) nous donne si un député est plutôt pour ou contre.\nPas très utile en soit mais peut être intéressant car il suffit de sélectionne les scrutins en sélection les colonnes avec `X.[]`.  \nUne somme sur les colonnes (`X.sum()`) nous donne le résultat des scrutins.\n\nIl est certainement possible de faire la même chose avec scikit-learn mais pourquoi s'embêter quand cela fonctionne et que c'est relativement simple.\n\n\n### réduire à deux dimensions avec une PCA\n\nUne Analyse en Composantes Principales ([PCA]) est une méthode de réduction de dimension.\nL'idée est de trouver les plans qui expliquent le mieux la variance des données.\nComme une sorte de régression linéaire mais avec beaucoup de variables en entrée et un peu moins en sortie.\n\nAvec la méthode [`PCA`][PCA-sklearn] de `scikit-learn`, c'est relativement simple.\nIl suffit d'entrainer le modèle sur les données $X$ et de l'appliquer à ces mêmes données $X_r = f(X)$ avec la méthode `fit_transform` qui fait ce qu'elle dit.\n\n[PCA]: https://fr.wikipedia.org/wiki/Analyse_en_composantes_principales\n[PCA-sklearn]: https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html\n\n::: {.cell execution_count=4}\n``` {.python .cell-code code-fold=\"false\"}\npca = PCA(n_components=2)\nX_r = pca.fit_transform(X.values)\n\nX_r\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```\narray([[-15.75063639,  -6.35683458],\n       [ -6.43963309,   1.39136881],\n       [  4.60791914,   3.62369401],\n       ...,\n       [-13.22659138,  -6.41688026],\n       [ -4.38482652,  -1.1218591 ],\n       [  0.83122716,   2.55143613]])\n```\n:::\n:::\n\n\nOn se retrouve avec une matrice de deux colonnes correspondant aux deux dimensions.\nC'est ce qu'on a demandé.\n\nIl faut maintenant recoller les morceaux avec un peu de pandas pour avoir un tableau avec les députés, leur position et leur groupe parlementaire.\nPour cela rien de plus quotidien qu'un petit [`join`][pd-join] pour se détendre.\n\n[pd-join]: https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.join.html\n\n::: {.cell execution_count=5}\n``` {.python .cell-code code-fold=\"false\"}\nmapping = (\n    pd\n    .DataFrame(X_r, columns=[\"axe 1\", \"axe 2\"])\n    .join(\n        X.reset_index()\n        .join(votes.drop_duplicates(subset='acteurRef').set_index('acteurRef'), on='acteurRef')\n        .join(organes.set_index('uid'), on='organe')\n    )\n    .set_index('acteurRef')\n)\n\nmapping\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>axe 1</th>\n      <th>axe 2</th>\n      <th>VTANR5L16V1</th>\n      <th>VTANR5L16V10</th>\n      <th>VTANR5L16V100</th>\n      <th>VTANR5L16V1000</th>\n      <th>VTANR5L16V1001</th>\n      <th>VTANR5L16V1002</th>\n      <th>VTANR5L16V1003</th>\n      <th>VTANR5L16V1004</th>\n      <th>...</th>\n      <th>regime</th>\n      <th>legislature</th>\n      <th>regimeJuridique</th>\n      <th>siteInternet</th>\n      <th>nombreReunionsAnnuelles</th>\n      <th>secretariat</th>\n      <th>listePays</th>\n      <th>positionPolitique</th>\n      <th>preseance</th>\n      <th>couleurAssociee</th>\n    </tr>\n    <tr>\n      <th>acteurRef</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>PA1008</th>\n      <td>-15.750636</td>\n      <td>-6.356835</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>6.0</td>\n      <td>#DF84B5</td>\n    </tr>\n    <tr>\n      <th>PA1206</th>\n      <td>-6.439633</td>\n      <td>1.391369</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>99.0</td>\n      <td>#8D949A</td>\n    </tr>\n    <tr>\n      <th>PA1327</th>\n      <td>4.607919</td>\n      <td>3.623694</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>4.0</td>\n      <td>#4565AD</td>\n    </tr>\n    <tr>\n      <th>PA1567</th>\n      <td>-12.969329</td>\n      <td>-5.880126</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>6.0</td>\n      <td>#DF84B5</td>\n    </tr>\n    <tr>\n      <th>PA1592</th>\n      <td>0.488657</td>\n      <td>1.149012</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>99.0</td>\n      <td>#8D949A</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>PA805166</th>\n      <td>9.002075</td>\n      <td>-0.260314</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Minoritaire</td>\n      <td>5.0</td>\n      <td>#CE5215</td>\n    </tr>\n    <tr>\n      <th>PA817203</th>\n      <td>5.749284</td>\n      <td>1.522692</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Majoritaire</td>\n      <td>1.0</td>\n      <td>#61468F</td>\n    </tr>\n    <tr>\n      <th>PA817211</th>\n      <td>-13.226591</td>\n      <td>-6.416880</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>3.0</td>\n      <td>#E42313</td>\n    </tr>\n    <tr>\n      <th>PA822617</th>\n      <td>-4.384827</td>\n      <td>-1.121859</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>10.0</td>\n      <td>#F8D434</td>\n    </tr>\n    <tr>\n      <th>PA942</th>\n      <td>0.831227</td>\n      <td>2.551436</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-1.0</td>\n      <td>-1.0</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>10.0</td>\n      <td>#F8D434</td>\n    </tr>\n  </tbody>\n</table>\n<p>581 rows × 1888 columns</p>\n</div>\n```\n:::\n:::\n\n\n### visualiser les députés\n\nAvant de passer à la visualisation, prenons un petit moment pour préparer de jolis tables qui pourront être utilisé par des publics moins avertis ou pour afficher des données contextuelles dans une visualisation interactive.\n\nCommencons par les députés :\n\n::: {.cell execution_count=6}\n``` {.python .cell-code code-fold=\"false\"}\nacteurs_pca = (\n    mapping\n    [['axe 1','axe 2', 'organe']]\n    .join(acteurs.set_index('uid'))\n    .join(organes.set_index('uid')[['libelleAbrev', 'couleurAssociee']], on='organe')\n)\n\nacteurs_pca\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>axe 1</th>\n      <th>axe 2</th>\n      <th>organe</th>\n      <th>nom</th>\n      <th>prenom</th>\n      <th>civ</th>\n      <th>libelleAbrev</th>\n      <th>couleurAssociee</th>\n    </tr>\n    <tr>\n      <th>acteurRef</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>PA1008</th>\n      <td>-15.750636</td>\n      <td>-6.356835</td>\n      <td>PO800496</td>\n      <td>David</td>\n      <td>Alain</td>\n      <td>M.</td>\n      <td>SOC</td>\n      <td>#DF84B5</td>\n    </tr>\n    <tr>\n      <th>PA1206</th>\n      <td>-6.439633</td>\n      <td>1.391369</td>\n      <td>PO793087</td>\n      <td>Dupont-Aignan</td>\n      <td>Nicolas</td>\n      <td>M.</td>\n      <td>NI</td>\n      <td>#8D949A</td>\n    </tr>\n    <tr>\n      <th>PA1327</th>\n      <td>4.607919</td>\n      <td>3.623694</td>\n      <td>PO800508</td>\n      <td>Forissier</td>\n      <td>Nicolas</td>\n      <td>M.</td>\n      <td>LR</td>\n      <td>#4565AD</td>\n    </tr>\n    <tr>\n      <th>PA1567</th>\n      <td>-12.969329</td>\n      <td>-5.880126</td>\n      <td>PO800496</td>\n      <td>Guedj</td>\n      <td>Jérôme</td>\n      <td>M.</td>\n      <td>SOC</td>\n      <td>#DF84B5</td>\n    </tr>\n    <tr>\n      <th>PA1592</th>\n      <td>0.488657</td>\n      <td>1.149012</td>\n      <td>PO793087</td>\n      <td>Habib</td>\n      <td>David</td>\n      <td>M.</td>\n      <td>NI</td>\n      <td>#8D949A</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>PA805166</th>\n      <td>9.002075</td>\n      <td>-0.260314</td>\n      <td>PO800484</td>\n      <td>Bergantz</td>\n      <td>Anne</td>\n      <td>Mme</td>\n      <td>DEM</td>\n      <td>#CE5215</td>\n    </tr>\n    <tr>\n      <th>PA817203</th>\n      <td>5.749284</td>\n      <td>1.522692</td>\n      <td>PO800538</td>\n      <td>Miller</td>\n      <td>Laure</td>\n      <td>Mme</td>\n      <td>RE</td>\n      <td>#61468F</td>\n    </tr>\n    <tr>\n      <th>PA817211</th>\n      <td>-13.226591</td>\n      <td>-6.416880</td>\n      <td>PO800490</td>\n      <td>Pilato</td>\n      <td>René</td>\n      <td>M.</td>\n      <td>LFI-NUPES</td>\n      <td>#E42313</td>\n    </tr>\n    <tr>\n      <th>PA822617</th>\n      <td>-4.384827</td>\n      <td>-1.121859</td>\n      <td>PO800532</td>\n      <td>Froger</td>\n      <td>Martine</td>\n      <td>Mme</td>\n      <td>LIOT</td>\n      <td>#F8D434</td>\n    </tr>\n    <tr>\n      <th>PA942</th>\n      <td>0.831227</td>\n      <td>2.551436</td>\n      <td>PO800532</td>\n      <td>de Courson</td>\n      <td>Charles</td>\n      <td>M.</td>\n      <td>LIOT</td>\n      <td>#F8D434</td>\n    </tr>\n  </tbody>\n</table>\n<p>581 rows × 8 columns</p>\n</div>\n```\n:::\n:::\n\n\nPuis les groupes parlementaires en calculant la position médiannne avec un [`groupby`][pd-groupby] et [`median`][pd-median].\n\nAu passage, on trie les groupes en fonction de l'axe 2 qui correspond à un axe gauche-droite.\nCela permet d'afficher un tas de choses automatiquement sans avoir à classer manuellement les groupes.\n\n[pd-groupby]: https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html\n[pd-median]: https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.median.html\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\naxe = (\n    mapping\n    [['axe 1','axe 2', 'organe']]\n    .groupby('organe')\n    .median()\n    .sort_values('axe 2')\n)\n\n(\n    axe\n    .join(organes.set_index('uid'))\n    .set_index('libelle')\n)\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>axe 1</th>\n      <th>axe 2</th>\n      <th>@xmlns</th>\n      <th>@xmlns:xsi</th>\n      <th>@xsi:type</th>\n      <th>codeType</th>\n      <th>libelleEdition</th>\n      <th>libelleAbrege</th>\n      <th>libelleAbrev</th>\n      <th>viMoDe</th>\n      <th>...</th>\n      <th>regime</th>\n      <th>legislature</th>\n      <th>regimeJuridique</th>\n      <th>siteInternet</th>\n      <th>nombreReunionsAnnuelles</th>\n      <th>secretariat</th>\n      <th>listePays</th>\n      <th>positionPolitique</th>\n      <th>preseance</th>\n      <th>couleurAssociee</th>\n    </tr>\n    <tr>\n      <th>libelle</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>Écologiste - NUPES</th>\n      <td>-15.940413</td>\n      <td>-9.220727</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe Écologiste - NUPES</td>\n      <td>Ecolo - NUPES</td>\n      <td>ECOLO</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>8.0</td>\n      <td>#77AA79</td>\n    </tr>\n    <tr>\n      <th>La France insoumise - Nouvelle Union Populaire écologique et sociale</th>\n      <td>-18.870966</td>\n      <td>-8.625866</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe La France insoumise - Nouvelle Union...</td>\n      <td>LFI - NUPES</td>\n      <td>LFI-NUPES</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>3.0</td>\n      <td>#E42313</td>\n    </tr>\n    <tr>\n      <th>Socialistes et apparentés (membre de l’intergroupe NUPES)</th>\n      <td>-12.208452</td>\n      <td>-5.517531</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe Socialistes et apparentés (membre de...</td>\n      <td>SOC</td>\n      <td>SOC</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>6.0</td>\n      <td>#DF84B5</td>\n    </tr>\n    <tr>\n      <th>Gauche démocrate et républicaine - NUPES</th>\n      <td>-11.280576</td>\n      <td>-3.909381</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe de la Gauche démocrate et républicai...</td>\n      <td>GDR - NUPES</td>\n      <td>GDR-NUPES</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>9.0</td>\n      <td>#991414</td>\n    </tr>\n    <tr>\n      <th>Démocrate (MoDem et Indépendants)</th>\n      <td>12.184351</td>\n      <td>-1.573154</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe Démocrate (MoDem et Indépendants)</td>\n      <td>Dem</td>\n      <td>DEM</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Minoritaire</td>\n      <td>5.0</td>\n      <td>#CE5215</td>\n    </tr>\n    <tr>\n      <th>Renaissance</th>\n      <td>14.130518</td>\n      <td>-1.349316</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe Renaissance</td>\n      <td>RE</td>\n      <td>RE</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Majoritaire</td>\n      <td>1.0</td>\n      <td>#61468F</td>\n    </tr>\n    <tr>\n      <th>Horizons et apparentés</th>\n      <td>11.375504</td>\n      <td>-1.042384</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe Horizons et apparentés</td>\n      <td>HOR</td>\n      <td>HOR</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Minoritaire</td>\n      <td>7.0</td>\n      <td>#32B3CA</td>\n    </tr>\n    <tr>\n      <th>Libertés, Indépendants, Outre-mer et Territoires</th>\n      <td>-5.112847</td>\n      <td>-0.817343</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe Libertés, Indépendants, Outre-mer et...</td>\n      <td>LIOT</td>\n      <td>LIOT</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>10.0</td>\n      <td>#F8D434</td>\n    </tr>\n    <tr>\n      <th>Non inscrit</th>\n      <td>-2.809973</td>\n      <td>1.270190</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>des députés non inscrits</td>\n      <td>NI</td>\n      <td>NI</td>\n      <td>{'dateDebut': '2022-06-22', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>99.0</td>\n      <td>#8D949A</td>\n    </tr>\n    <tr>\n      <th>Les Républicains</th>\n      <td>1.258472</td>\n      <td>3.749839</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe Les Républicains</td>\n      <td>LR</td>\n      <td>LR</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>4.0</td>\n      <td>#4565AD</td>\n    </tr>\n    <tr>\n      <th>Rassemblement National</th>\n      <td>-10.763626</td>\n      <td>13.831876</td>\n      <td>http://schemas.assemblee-nationale.fr/referentiel</td>\n      <td>http://www.w3.org/2001/XMLSchema-instance</td>\n      <td>GroupePolitique_type</td>\n      <td>GP</td>\n      <td>du groupe Rassemblement National</td>\n      <td>RN</td>\n      <td>RN</td>\n      <td>{'dateDebut': '2022-06-28', 'dateAgrement': No...</td>\n      <td>...</td>\n      <td>5ème République</td>\n      <td>16.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>{'secretaire01': None, 'secretaire02': None}</td>\n      <td>NaN</td>\n      <td>Opposition</td>\n      <td>2.0</td>\n      <td>#35495E</td>\n    </tr>\n  </tbody>\n</table>\n<p>11 rows × 22 columns</p>\n</div>\n```\n:::\n:::\n\n\nVoilà tout est prêt pour la touche finale et laisser matplotlib faire sa magie.\nRien de spécial au niveau de la visualisation, c'est la fonction [`df.plot.scatter`][df-plot-scatter] qui fait tout le travail.\nOn cache les axes, par préférence personelle comme les valeurs n'ont pas une grande importance, et on ajoute une légende avec les groupes parlementaires.\n\n[df-plot-scatter]: https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.plot.scatter.html\n\n::: {.cell layout-ncol='1' execution_count=8}\n``` {.python .cell-code code-fold=\"false\"}\nfig, ax = plt.subplots()\n\n(\n    axe\n    .join(organes.set_index('uid'))\n    .plot\n    .scatter(\n        x=\"axe 2\",\n        y=\"axe 1\",\n        c=\"couleurAssociee\",\n        alpha=0.3,\n        s=5000,\n        ax=ax,\n    )\n)\n\n(\n    mapping\n    .plot\n    .scatter(\n        x=\"axe 2\",\n        y=\"axe 1\",\n        s=12,\n        alpha= 0.7,\n        c=\"couleurAssociee\",\n        figsize=(15,10),\n        ax=ax\n    )\n)\n\nplt.legend(\n    handles=[\n        plt.Line2D([0], [0], marker='o', color='w', label=org['libelle'], markerfacecolor=org['couleurAssociee'], markersize=15)\n        for org in axe.join(organes.set_index('uid')).to_records()\n    ],\n    loc='upper center',\n    bbox_to_anchor=(0.5, -0.1),\n    ncol=3\n)\n\nax.axis('off')\n\nplt.savefig('graphics/acteurs_pca_scrutins.png', bbox_inches='tight')\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](pca-deputes_files/figure-html/cell-9-output-1.png){width=1141 height=927}\n:::\n:::\n\n\nÀ partir de là, il suffit de sauvegarder les données ou de les injecter pour l'intégrer au système de visualisation souhaité.\nPour l'article de Mediapart, c'est du datawrapper branché à un tableur en ligne.\n\n",
    "supporting": [
      "pca-deputes_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}